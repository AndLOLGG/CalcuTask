<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Subtask Overview</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
</head>
<body>
    <h3>Opgaver</h3>

<ul>
    <li th:each="sub : ${subTasks}">
        <span th:text="${sub.subtaskName}"></span>
        <span th:text="'Status: ' + ${sub.subtaskStatus}"></span>

        <!-- Hvis subtask ikke er påtaget -->
        <span th:if="${sub.assignedUserId == null}">
            <form th:action="@{/subtask/statusAndAssign}" method="post" style="display:inline;">
                <input type="hidden" name="subtaskId" th:value="${sub.subtaskId}" />
                <button type="submit" class="btn btn-success">Igang</button>
            </form>
        </span>

        <!-- Hvis subtask allerede er påtaget -->
        <span th:if="${sub.assignedUserId != null}">
            <em>☑ Påtaget af <span th:text="${sub.assignedUsername}"></span></em>

            <!-- Hvis bruger selv har påtaget sig -->
            <span th:if="${sub.assignedUserId == session.userId}">
                <span th:if="${sub.subtaskStatus == 'Igang'}">
                    <form th:action="@{/subtask/updateTaskStatus}" method="post" style="display:inline;">
                        <input type="hidden" name="status" value="Blokeret" />
                        <input type="hidden" name="subtaskId" th:value="${sub.subtaskId}" />
                        <button type="submit" class="btn btn-warning">Blokeret</button>
                    </form>

                    <form th:action="@{/subtask/updateTaskStatus}" method="post" style="display:inline;">
                        <input type="hidden" name="status" value="Test" />
                        <input type="hidden" name="subtaskId" th:value="${sub.subtaskId}" />
                        <button type="submit" class="btn btn-warning">Test</button>
                    </form>
                </span>

                <span th:if="${sub.subtaskStatus == 'Test'}">
                    <form th:action="@{/subtask/updateTaskStatus}" method="post" style="display:inline;">
                        <input type="hidden" name="status" value="Done" />
                        <input type="hidden" name="subtaskId" th:value="${sub.subtaskId}" />
                        <button type="submit" class="btn btn-success">Done</button>
                    </form>
                </span>

                <span th:if="${sub.subtaskStatus != 'Done'}">
                    <form th:action="@{/subtask/release}" method="post" style="display:inline;">
                        <input type="hidden" name="subtaskId" th:value="${sub.subtaskId}" />
                        <button type="submit" class="btn btn-danger">Frigiv</button>
                    </form>

                    <form th:action="@{/subtask/edit}" method="post" style="display:inline;">
                        <input type="hidden" name="subtaskId" th:value="${sub.subtaskId}" />
                        <button type="submit" class="btn btn-danger">Ret</button>
                    </form>
                </span>
            </span>
        </span>
    </li>
</ul>

<!-- Tilbage-knap -->
<a href="/project" class="btn btn-secondary">⬅ Tilbage til projekter</a>

</body>
</html>